#!/bin/bash

# Set toml filename
TOML_FILE="$HOME/.config/chezmoi/chezmoi.toml"

# Make it happen
refresh_dot_files() {
  echo "Applying dotfiles with chezmoi ..."
  chezmoi init --apply --verbose https://github.com/jonnnylingo/dotfiles.git
  chmod 0600 "$HOME/.config/chezmoi/chezmoi.toml"
  source ~/.zshrc
}

if [ -f ${TOML_FILE} ]; then
  echo "Backing up .config/chezmoi/chezmoi.toml"
  timestamp=$(date +%Y-%m-%d$Y-%H%M%S)
  mv ${TOML_FILE} ${TOML_FILE}-timestamp
else
  brew install chezmoi
fi

# Make fresh copy of dot_files
refresh_dot_files

#install oh-my-zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"

sed -i '1s/^/\source .bashrc\n/' ~/.zshrc
